<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.gmaking.notice.dao.NoticeDAO">

    <resultMap id="noticeMap" type="com.project.gmaking.notice.vo.NoticeVO">
        <id property="noticeId" column="NOTICE_ID"/>

        <result property="noticeTitle" column="NOTICE_TITLE"/>
        <result property="noticeContent" column="NOTICE_CONTENT"/>
        <result property="noticeViewCount" column="NOTICE_VIEW_COUNT"/>
        <result property="isPinned" column="IS_PINNED"/>

        <result property="createdBy" column="CREATED_BY"/>
        <result property="createdDate" column="CREATED_DATE"/>
        <result property="lastModifiedBy" column="LAST_MODIFIED_BY"/>
        <result property="lastModifiedDate" column="LAST_MODIFIED_DATE"/>
    </resultMap>

    <!-- 컬럼 반복 조회 방지 -->
    <sql id="noticeColumns">
        NOTICE_ID, NOTICE_TITLE, NOTICE_CONTENT, NOTICE_VIEW_COUNT, IS_PINNED,
        CREATED_BY, CREATED_DATE, LAST_MODIFIED_BY, LAST_MODIFIED_DATE
    </sql>

    <select id="selectNoticeCount" resultType="int">
        SELECT COUNT(*) FROM tb_notice
    </select>

    <select id="selectNoticeList" resultType="com.project.gmaking.notice.vo.NoticeVO">
        SELECT
        <include refid="noticeColumns" />
        FROM tb_notice
        ORDER BY IS_PINNED DESC, CREATED_DATE DESC
        LIMIT #{limit} OFFSET #{offset}
    </select>

    <select id="selectNoticeById" resultType="com.project.gmaking.notice.vo.NoticeVO">
        SELECT
        <include refid="noticeColumns" />
        FROM tb_notice
        WHERE NOTICE_ID = #{noticeId}
    </select>

    <insert id="insertNotice" parameterType="com.project.gmaking.notice.vo.NoticeVO">
        INSERT INTO tb_notice (
            NOTICE_TITLE,
            NOTICE_CONTENT,
            IS_PINNED,
            CREATED_BY
        ) VALUES (
            #{noticeTitle},
            #{noticeContent},
            #{isPinned},
            #{createdBy}
        )
        <selectKey keyProperty="noticeId" resultType="int" order="AFTER">
            SELECT LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="updateNotice" parameterType="com.project.gmaking.notice.vo.NoticeVO">
        UPDATE tb_notice
        SET
            NOTICE_TITLE = #{noticeTitle},
            NOTICE_CONTENT = #{noticeContent},
            IS_PINNED = #{isPinned},
            LAST_MODIFIED_BY = #{lastModifiedBy}
        WHERE NOTICE_ID = #{noticeId}
    </update>

    <delete id="deleteNotice">
        DELETE FROM tb_notice
        WHERE NOTICE_ID = #{noticeId}
    </delete>

    <update id="incrementViewCount">
        UPDATE tb_notice
        SET
            NOTICE_VIEW_COUNT = NOTICE_VIEW_COUNT + 1
        WHERE NOTICE_ID = #{noticeId}
    </update>

</mapper>